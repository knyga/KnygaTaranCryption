<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
	<head>
		<title>BlowFish - Алгоритм шифрования</title>
	</head>
	<body>
		<h1>Описание работы BlowFish</h1>
		<div>
			Blowfish является сетью Фейштеля, у которой количество итераций равно 16. Длина блока равна 64 битам, 
			ключ может иметь любую длину в пределах 448 бит. Хотя перед началом любого шифрования выполняется сложная
			 фаза инициализации, само шифрование данных выполняется достаточно быстро.
			Алгоритм предназначен в основном для приложений, в которых ключ меняется нечасто, к тому же существует фаза 
			начального рукопожатия, во время которой происходит аутентификация сторон и согласование общих 
			параметров и секретов. Классическим примером подобных приложений является сетевое взаимодействие.
			 При реализации на 32-битных микропроцессорах с большим кэшем данных Blowfish значительно быстрее DES.
			<br>
			Алгоритм состоит из двух частей: расширение ключа и шифрование данных. Расширение ключа преобразует ключ 
			длиной, по крайней мере, 448 бит в несколько массивов подключей общей длиной 4168 байт.
			В основе алгоритма лежит сеть Фейштеля с 16 итерациями. Каждая итерация состоит из перестановки, 
			зависящей от ключа, и подстановки, зависящей от ключа и данных. Операциями являются XOR и
			 сложение 32-битных слов.
			Blowfish использует большое количество подключей. Эти ключи должны быть вычислены заранее, 
			до начала любого шифрования или дешифрования данных. Элементы алгоритма: <br>
1.	Р - массив, состоящий из восемнадцати 32-битных подключей: <br>
Р<sub>1</sub>, Р<sub>2</sub>, ..., Р<sub>18</sub>.<br>
2.	Четыре 32-битных S-boxes c 256 входами каждый. Первый индекс означает номер S-box, второй индекс - номер входа. <br>
3.	S<sub>1,0</sub>, S<sub>1,1</sub>, … S<sub>1,255</sub>;<br>
4.	S<sub>2,0</sub>, S<sub>2,1</sub>, … S<sub>2,255</sub>;<br>
5.	S<sub>3,0</sub>, S<sub>3,1</sub>, … S<sub>3,255</sub>;<br>
6.	S<sub>4,0</sub>, S<sub>4,1</sub>, … S<sub>4,255</sub>;<br>
Метод, используемый для вычисления этих подключей, будет описан ниже.<br>
			<b>Шифрование</b><br>
Входом является 64-битный элемент данных X, который делится на две 32-битные половины,<br> X<sub>l</sub> и X<sub>r</sub>.<br>
X<sub>l</sub> = X<sub>l</sub> XOR P<sub>i</sub><br>
X<sub>r</sub> = F (X<sub>l</sub>) XOR X<sub>r</sub><br>
Swap X<sub>l</sub> and X<sub>r</sub><br>
Функция F<br>
Разделить X<sub>l</sub> на четыре 8-битных элемента A, B, C, D.<br>
			F (X<sub>l</sub>) = ((S<sub>1,А</sub> + S<sub>2,B</sub> mod 2<sup>32</sup>) XOR S<sub>3,C</sub>) + S<sub>4,D</sub> mod 2<sup>32</sup><br>
			<b>Дешифрование</b> отличается от шифрования тем, что P<sub>i</sub> используются в обратном порядке.<br>
			<br>
Генерация подключей<br>
Подключи вычисляются с использованием самого алгоритма Blowfish.<br>
1.	Инициализировать первый Р-массив и четыре S-boxes фиксированной строкой. <br>
2.	Выполнить операцию XOR P<sub>1</sub> с первыми 32 битами ключа, операцию XOR P<sub>2</sub> со вторыми 32 битами ключа и т.д. Повторять цикл до тех пор, пока весь Р-массив не будет побитово сложен со всеми битами ключа. Для коротких ключей выполняется конкатенация ключа с самим собой. <br>
3.	Зашифровать нулевую строку алгоритмом Blowfish, используя подключи, описанные в пунктах (1) и (2). <br>
4.	Заменить Р<sub>1</sub> и Р<sub>2</sub> выходом, полученным на шаге (3). <br>
5.	Зашифровать выход шага (3), используя алгоритм Blowfish с модифицированными подключами. <br>
6.	Заменить Р<sub>3</sub> и Р<sub>4</sub> выходом, полученным на шаге (5). <br>
7.	Продолжить процесс, заменяя все элементы Р-массива, а затем все четыре S-boxes, выходами соответствующим образом модифицированного алгоритма Blowfish.<br>
Для создания всех подключей требуется 521 итерация.
		</div>
	</body>
</html>
